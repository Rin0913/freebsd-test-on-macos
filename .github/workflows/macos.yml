name: macOS Workflow
on: [push]
jobs:
  test-macos:
    name: test on macOS
    runs-on: macos-latest
    steps:
      - name: checkout
        uses: actions/checkout@v4
      - name: install bmake
        run: brew install bmake llvm
      - name: link llvm-objcopy
        run: brew link llvm --force
      - name: test
        run: sh -ex test.sh
      - name: simple test
        run: outputs/cat/cat /etc/hosts
      - name: install port
        run: |
          xcode-select --install || true
          git clone https://github.com/macports/macports-base.git
          cd macports-base
          ./configure --prefix=/opt/local
          make -j$(sysctl -n hw.ncpu)
          sudo make install
          sudo port -v selfupdate
          cd ../
